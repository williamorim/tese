%% ------------------------------------------------------------------------- %%
\chapter{Obtendo dados de poluição}

\begin{flushright}
	\textcolor{gray}{
		\begin{tabular}{r}
			The fact that data science exists as a field \\
			is a colossal failure of statistics. \\
			To me, what I do is what statistics is all about. \\
			It is gaining insight from data using modelling and visualization. \\
			Data munging and manipulation is hard \\
			and statistics has just said that's not our domain. \\
			--- Hadley Wickham		
		\end{tabular} 
	}
	\vspace{5mm}
\end{flushright}

Uma etapa crucial da análise de dados, muitas vezes menosprezada pelos estatísticos como não sendo parte da Estatística, é a coleta e a estruturação de dados. De uma maneira geral, a obtenção de dados para análise requer a realização de experimentos, medições ou aplicação de questionários, e a sua estruturação se refere à transferência dos registros obtidos na coleta para uma base de dados retangular\footnote{Em que cada linha representa uma observação (unidade amostral) e cada coluna representa uma variável.}. Às vezes, no entanto, os dados que queremos analisar já foram coletados por terceiros e estão disponíveis (mas nem sempre acessíveis) na internet.

Dados de poluição, pela sua relevância para a saúde pública, costumam ser medidos e disponibilizados gratuitamente por órgãos públicos. Embora dificilmente haja interesse político para dificultar o acesso desses dados, como muitas vezes acontece com dados públicos governamentais e de tribunais, o acesso a eles nem sempre é construído maneira ótima e raramente a base se encontra estruturada para análise. A principal causa disso é falta de comunicação entre o responsável pela disponibilização dos dados e a pessoa que vai de fato analisá-los.

Com o aumento da disponibilização de dados na internet ao lado da dificuldade de acesso e estruturação, um \textit{framework} de coleta de dados conhecido \textit{web scraping} (ou raspagem de dados web) vem se tornando cada vez mais popular. Seu objetivo é criar rotinas computacionais para baixar dados de páginas e sistemas na internet de forma automática e estruturada. Embora essas rotinas exijam conhecimento de programação web, elas podem ser realizadas no mesmo ambiente da análise de dados quando utilizamos linguagens como o R ou o Python. 
 
Nesta seção, discutiremos os conceitos básicos de web scraping e apresentaremos algumas formas de se obter dados de poluição do ar, tanto no Brasil quanto em outros lugares do mundo.

\section{Web scraping}
  
  
  
  
\section{Dados no Brasil}

Para o estado de São Paulo, a CETESB (Companhia Ambiental do Estado de São Paulo) oferece um sistema de consulta de medidas em tempo real e de relatórios diários, mensais e anuais. O sistema, chamado \textit{Qualar}, também permite a exportação de diversas séries históricas de poluentes e parâmetros meteorológicos, além de informações sobre as estações de monitoramento. 

Para facilitar o acesso aos dados, já que o sistema possui restrições estruturais (como baixar dados de vários poluentes ou estações de uma única vez) e também pode se tornar lento quando precisamos acessar séries muito longas, nós criamos o pacote \texttt{koffing}, em R. O processo se resume ao uso da função \texttt{scraper\_cetesb()}, que tem, entre outros argumentos, o parâmetro a ser baixado, a estação medidora e o login e senha de acesso ao Qualar. Dada uma lista de parâmetros e estações, a função pode ser utilizada dentro de um \textit{looping} para baixar os dados de diversas estações e poluentes automaticamente. Para instalar o pacote, basta rodar o seguinte comando \texttt{devtools::install\_github("atmoschem/koffing")}.

\section{Dados em outros países}

Lançado em março de 2000, o programa MOPPIT (\textit{Measurements Of Pollution In The Troposphere}) lançado pela NASA tem como objetivo medir o monóxido de carbono troposférico em escala global. Os dados podem ser baixados diretamente do seguinte site: \url{https://search.earthdata.nasa.gov/}. Além dos dados do MOPPIT, a NASA possui diversas outros dados atmosféricos que podem ser baixados pelo portal \url{https://eosweb.larc.nasa.gov/}, como concentração de aerossóis, formação de  nuvens, radiação e composição da troposfera. 

